<!-- Mobile menu toggle button -->
<button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
    <span></span>
    <span></span>
    <span></span>
</button>

<nav class="sidebar">
    <a href="{{ '/' | relative_url }}" class="sidebar-title-link">
        <div class="sidebar-title">An Invitation to Category Theory</div>
        <div class="sidebar-subtitle">Formalized in Agda</div>
    </a>

    {% assign sectionOrder = "Plumbing,Definitions,Propositions,Examples,Exercises,Not in Textbook" | split: "," %}
    {% assign grouped = site.pages | where_exp: "page", "page.section != nil" | group_by: "section" %}
    {% assign sections = "" | split: "" %}

    {% for name in sectionOrder %}
    {% assign match = grouped | where: "name", name | first %}
    {% if match %}
    {% assign sections = sections | push: match %}
    {% endif %}
    {% endfor %}


    {% for section_group in sections %}
    {% assign section_pages = section_group.items | sort: "number" %}
    {% assign section_contains_current = false %}
    {% for pg in section_pages %}
        {% if pg.url == page.url %}
            {% assign section_contains_current = true %}
        {% endif %}
    {% endfor %}

    <details class="nav-section"{% if section_contains_current %} open{% endif %}>
        <summary>{{ section_group.name }}</summary>
        <ol>
            {% for pg in section_pages %}
            {% assign is_current_page = false %}
            {% if pg.url == page.url %}
                {% assign is_current_page = true %}
            {% endif %}

            <li>
                {% if pg.subsections %}
                <details class="nav-subsection"{% if is_current_page %} open{% endif %}>
                    <summary><a href="{{ pg.url | relative_url }}"{% if is_current_page %} class="current-page"{% endif %}>{{ pg.chapter }}.{{ pg.number }} {{ pg.title
                            }}</a></summary>
                    <ol>
                        {% for subsection in pg.subsections %}
                        <li><a href="{{ pg.url | relative_url }}#{{ subsection.anchor }}">{{ subsection.chapter }}.{{
                                subsection.number }} {{ subsection.name }}</a></li>
                        {% endfor %}
                    </ol>
                </details>
                {% else %}
                <a href="{{ pg.url | relative_url }}"{% if is_current_page %} class="current-page"{% endif %}>{{ pg.chapter }}.{{ pg.number }} {{ pg.title }}</a>
                {% endif %}
            </li>
            {% endfor %}
        </ol>
    </details>
    {% endfor %}
</nav>